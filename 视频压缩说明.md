# 视频压缩工具使用说明

## 概述

本工具用于压缩项目中 `game/videos` 目录下的所有 MP4 视频文件，帮助减少项目体积，提高加载速度。

## 文件说明

- `compress_videos.sh` - 主压缩脚本
- `视频压缩说明.md` - 本说明文档

## 使用方法

### 1. 基本使用

```bash
# 在项目根目录执行
./compress_videos.sh
```

### 2. 压缩参数说明

脚本使用以下默认参数：

- **质量设置 (CRF)**: 23
  - 范围：0-51，数值越小质量越高
  - 推荐值：18-28
  - 18: 视觉无损质量
  - 23: 默认值，平衡质量和文件大小
  - 28: 较高压缩率

- **编码预设**: medium
  - ultrafast: 最快编码，文件较大
  - fast: 快速编码
  - medium: 平衡速度和压缩率（默认）
  - slow: 较慢编码，更好压缩
  - veryslow: 最慢编码，最佳压缩

### 3. 自定义参数

如需修改压缩参数，编辑脚本中的配置部分：

```bash
QUALITY="23"     # 修改质量值
PRESET="medium"  # 修改编码预设
```

## 输出结果

### 目录结构

压缩后的文件将保存在 `game/videos_compressed` 目录：

```
game/videos_compressed/
├── bg/     # 背景视频
├── cg/     # CG视频
└── ui/     # UI视频
```

### 压缩报告

脚本会显示详细的压缩信息：

- 每个文件的原始大小和压缩后大小
- 单个文件的压缩率
- 总体压缩统计
- 节省的存储空间

## 当前视频文件统计

根据扫描结果，项目包含以下视频文件：

### 背景视频 (bg/)
- 10个文件，总大小约 400MB
- 最大文件：bg_heroine_ritual.mp4 (73MB)

### CG视频 (cg/)
- 19个文件，总大小约 500MB
- 最大文件：cg_heroine_ritual_scene.mp4 (73MB)

### UI视频 (ui/)
- 1个文件：ui_opening.mp4 (38MB)

**总计：30个文件，约 1GB**

## 预期压缩效果

使用默认设置 (CRF 23)，预期可以：

- 压缩率：30-50%
- 节省空间：300-500MB
- 质量损失：几乎不可察觉

## 安全特性

- ✅ 原始文件保持不变
- ✅ 压缩文件保存到独立目录
- ✅ 支持断点续传（跳过已存在的文件）
- ✅ 详细的错误处理和日志

## 注意事项

1. **系统要求**：需要安装 ffmpeg
2. **磁盘空间**：确保有足够空间存储压缩文件
3. **处理时间**：根据文件大小和系统性能，可能需要几分钟到几十分钟
4. **质量检查**：压缩完成后建议抽查几个文件确认质量

## 替换原文件（可选）

如果压缩效果满意，可以手动替换原文件：

```bash
# 备份原文件
mv game/videos game/videos_original

# 使用压缩文件
mv game/videos_compressed game/videos
```

## 故障排除

### 常见问题

1. **ffmpeg 未安装**
   ```bash
   # macOS
   brew install ffmpeg
   
   # Ubuntu/Debian
   sudo apt install ffmpeg
   ```

2. **权限错误**
   ```bash
   chmod +x compress_videos.sh
   ```

3. **磁盘空间不足**
   - 清理临时文件
   - 分批处理文件

### 获取帮助

如遇到问题，请检查：
- 终端输出的错误信息
- 文件权限设置
- 可用磁盘空间
- ffmpeg 版本兼容性